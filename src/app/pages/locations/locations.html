<div class="p-6 bg-gray-50 min-h-screen relative">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-semibold text-[#0F7B8A]">Locations Management</h1>
      <p class="text-gray-600 text-base mt-1">Manage and organize all facility locations</p>
    </div>

    <button
      (click)="openModal()"
      class="bg-[#0F7B8A] cursor-pointer text-white px-4 py-2 rounded-lg transition hover:bg-[#0c656c] disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-color duration-300"
    >
      <i class="fa-solid fa-plus"></i>
      Add New Location
    </button>
  </div>

<!-- Stats Cards -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-lg p-5 shadow-sm border border-gray-100">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Locations</p>
          <p class="text-xl font-bold text-gray-700 mt-1">{{ locations.length }}</p>
        </div>
        <div class="bg-blue-100 rounded-full w-12 h-12 flex items-center justify-center">
          <i class="fa-solid fa-map-marked-alt text-blue-600 text-base"></i>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg p-5 shadow-sm border border-gray-100">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Cities</p>
          <p class="text-xl font-bold text-gray-700 mt-1">{{ getUniqueCities().length }}</p>
        </div>
        <div class="bg-emerald-100 rounded-full w-12 h-12 flex items-center justify-center">
          <i class="fa-solid fa-building text-emerald-600 text-base"></i>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg p-5 shadow-sm border border-gray-100">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Countries</p>
          <p class="text-xl font-bold text-gray-700 mt-1">{{ getUniqueCountries().length }}</p>
        </div>
        <div class="bg-amber-100 rounded-full w-12 h-12 flex items-center justify-center">
          <i class="fa-solid fa-earth-americas text-amber-600 text-base"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-16">
    <div class="text-center">
      <div class="animate-spin rounded-full h-14 w-14 border-b-2 border-pro mx-auto mb-3"></div>
      <p class="text-gray-600 text-base font-medium">Loading locations...</p>
    </div>
  </div>

  <!-- Locations Grid -->
  <div *ngIf="!isLoading && locations.length > 0" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">
    <div
      *ngFor="let loc of locations"
      class="bg-white rounded-xl p-6 border border-gray-200 hover:border-pro hover:shadow-lg transition-all duration-300 group relative overflow-hidden"
    >
      <!-- Background Pattern -->
      <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-pro/5 to-transparent rounded-full -mr-12 -mt-12"></div>

      <!-- Card Header -->
      <div class="flex items-center justify-between mb-5 relative z-10">
        <div class="bg-pro2 rounded-xl w-14 h-14 flex items-center justify-center text-pro shadow-md">
          <i class="fa-solid fa-location-dot text-lg"></i>
        </div>
        <div class="flex gap-2 opacity-0 group-hover:opacity-100 transform group-hover:translate-x-0 translate-x-3">
          <button
            (click)="openModal(loc)"
            class="p-3 rounded-lg hover:bg-teal-100 cursor-pointer transition-all duration-200 border border-gray-200 hover:border-gray-300 shadow-sm"
            title="Edit Location"
          >
            <i class="fa-solid fa-pen-to-square text-gray-600 h"></i>
          </button>
          <button
            (click)="confirmDelete(loc)"
            class="p-3 rounded-lg hover:bg-red-50 cursor-pointer transition-all duration-200 border border-gray-200 hover:border-red-200 shadow-sm"
            title="Delete Location"
          >
            <i class="fa-solid fa-trash text-red-500"></i>
          </button>
        </div>
      </div>

      <!-- Location Details -->
      <div class="space-y-4 relative z-10">
        <div>
          <h3 class="text-lg font-bold text-gray-600 mb-2">{{ loc.name }}</h3>
          <div class="flex items-center gap-2 text-sm text-gray-600">
            <i class="fa-solid fa-flag text-pro"></i>
            <span>{{ loc.city }}, {{ loc.country }}</span>
          </div>
        </div>

        <div class="space-y-3">
          <div class="flex items-start gap-3">
            <i class="fa-solid fa-location-crosshairs text-pro mt-1"></i>
            <div>
              <p class="text-sm font-semibold text-gray-500">Full Address</p>
              <p class="text-sm text-gray-600 mt-1 leading-relaxed">{{ getDisplayAddress(loc) }}</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="flex items-center gap-2 text-gray-600">
              <i class="fa-solid fa-earth-americas text-pro"></i>
              <span class="font-medium">{{ loc.country }}</span>
            </div>
            <div class="flex items-center gap-2 text-gray-600">
              <i class="fa-solid fa-envelope text-pro"></i>
              <span class="font-medium">{{ loc.postalCode }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && locations.length === 0" class="text-center py-16">
    <div class="bg-white rounded-2xl p-8 max-w-md mx-auto border border-gray-200 shadow-sm">
      <div class="bg-pro bg-opacity-10 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-5">
        <i class="fa-solid fa-location-dot text-pro text-2xl"></i>
      </div>
      <h3 class="text-xl font-bold text-gray-700 mb-3">No Locations Configured</h3>
      <p class="text-gray-600 text-base mb-6 max-w-md mx-auto leading-relaxed">
        Start by adding your first location to manage your facilities and work sites efficiently.
      </p>
      <button
        (click)="openModal()"
        class="bg-pro text-white px-7 py-3.5 rounded-lg cursor-pointer transition hover:bg-pro-hover shadow-lg hover:shadow-xl font-semibold text-base flex items-center gap-2 mx-auto"
      >
        <i class="fa-solid fa-plus"></i>
        Create First Location
      </button>
    </div>
  </div>

  <!-- Add/Edit Modal -->
  <div
    *ngIf="isModalOpen"
    class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 backdrop-blur-sm backdrop-brightness-80"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl transform transition-all scale-100 animate-fadeIn border border-gray-200 max-h-[90vh] overflow-y-auto">
      <h3 class="text-2xl font-semibold mb-6 text-gray-600">
        {{ isEditing ? 'Edit Location' : 'Add New Location' }}
      </h3>

      <form (ngSubmit)="saveLocation()" class="space-y-6">
        <!-- Location Name -->
        <div class="relative">
          <input
            type="text"
            [(ngModel)]="newLocation.name"
            name="name"
            placeholder=" "
            class="text-gray-700 peer w-full border rounded-lg p-3 border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro outline-none transition"
            [class.border-red-500]="formErrors.name"
            required
            maxlength="100"
          />

          <label
            class="absolute left-3 pointer-events-none text-gray-400 text-sm bg-white px-1 transition-all duration-300
              peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2
              peer-focus:top-0 peer-focus:-translate-y-1/2 peer-focus:text-xs peer-focus:text-pro
              peer-not-placeholder-shown:top-0 peer-not-placeholder-shown:-translate-y-1/2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro"
          >
            Location Name
            <span class="text-red-500">*</span>
          </label>
          <p *ngIf="formErrors.name" class="text-red-500 text-xs mt-2 flex items-center gap-1">
            <i class="fa-solid fa-exclamation-circle"></i>
            {{ formErrors.name }}
          </p>
        </div>

        <!-- Street Address -->
        <div class="relative">
          <input
            type="text"
            [(ngModel)]="newLocation.street"
            name="street"
            placeholder=" "
            class="text-gray-700 peer w-full border rounded-lg p-3 border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro outline-none transition"
            [class.border-red-500]="formErrors.street"
            required
            maxlength="200"
          />
          <label
            class="absolute left-3 pointer-events-none text-gray-400 text-sm bg-white px-1 transition-all duration-300
              peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2
              peer-focus:top-0 peer-focus:-translate-y-1/2 peer-focus:text-xs peer-focus:text-pro
              peer-not-placeholder-shown:top-0 peer-not-placeholder-shown:-translate-y-1/2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro"
          >
            Street Address
            <span class="text-red-500">*</span>
          </label>
          <p *ngIf="formErrors.street" class="text-red-500 text-xs mt-2 flex items-center gap-1">
            <i class="fa-solid fa-exclamation-circle"></i>
            {{ formErrors.street }}
          </p>
        </div>

        <!-- City & State Row -->
        <div class="grid grid-cols-2 gap-5">
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="newLocation.city"
              name="city"
              placeholder=" "
              class="text-gray-700 peer w-full border rounded-lg p-3 border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro outline-none transition"
              [class.border-red-500]="formErrors.city"
              required
              maxlength="50"
            />
            <label
              class="absolute left-3 pointer-events-none text-gray-400 text-sm bg-white px-1 transition-all duration-300
              peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2
              peer-focus:top-0 peer-focus:-translate-y-1/2 peer-focus:text-xs peer-focus:text-pro
              peer-not-placeholder-shown:top-0 peer-not-placeholder-shown:-translate-y-1/2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro" >
              City
              <span class="text-red-500">*</span>
            </label>

            <p *ngIf="formErrors.city" class="text-red-500 text-xs mt-2 flex items-center gap-1">
              <i class="fa-solid fa-exclamation-circle"></i>
              {{ formErrors.city }}
            </p>
          </div>

          <div class="relative">
            <input
              type="text"
              [(ngModel)]="newLocation.state"
              name="state"
              placeholder=" "
              class="text-gray-700 peer w-full border rounded-lg p-3 border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro outline-none transition"
              [class.border-red-500]="formErrors.state"
              required
              maxlength="50"
            />
            <label
              class="absolute left-3 pointer-events-none text-gray-400 text-sm bg-white px-1 transition-all duration-300
              peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2
              peer-focus:top-0 peer-focus:-translate-y-1/2 peer-focus:text-xs peer-focus:text-pro
              peer-not-placeholder-shown:top-0 peer-not-placeholder-shown:-translate-y-1/2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro">
              State/Province
              <span class="text-red-500">*</span>
            </label>
            <p *ngIf="formErrors.state" class="text-red-500 text-xs mt-2 flex items-center gap-1">
              <i class="fa-solid fa-exclamation-circle"></i>
              {{ formErrors.state }}
            </p>
          </div>
        </div>

        <!-- Country & Postal Code Row -->
        <div class="grid grid-cols-2 gap-5">
          <div class="relative">

            <select
              [(ngModel)]="newLocation.country"
              name="country"
              class="text-gray-700 w-full px-4 py-3.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pro focus:border-pro outline-none transition-all duration-200 bg-gray-50 focus:bg-white text-base appearance-none cursor-pointer"
              [class.border-red-500]="formErrors.country"
              required
            >
              <option value="">Select a country</option>
              <option value="Egypt">Egypt</option>
              <option value="Saudi Arabia">Saudi Arabia</option>
              <option value="United Arab Emirates">United Arab Emirates</option>
              <option value="Qatar">Qatar</option>
              <option value="Kuwait">Kuwait</option>
              <option value="Oman">Oman</option>
              <option value="Bahrain">Bahrain</option>
              <option value="Jordan">Jordan</option>
              <option value="Lebanon">Lebanon</option>
              <option value="Morocco">Morocco</option>
              <option value="Algeria">Algeria</option>
              <option value="Tunisia">Tunisia</option>
              <option value="United States">United States</option>
              <option value="United Kingdom">United Kingdom</option>
              <option value="Canada">Canada</option>
              <option value="France">France</option>
              <option value="Germany">Germany</option>
              <option value="Italy">Italy</option>
              <option value="Spain">Spain</option>
              <option value="Turkey">Turkey</option>
              <option value="India">India</option>
              <option value="China">China</option>
              <option value="Japan">Japan</option>
              <option value="South Korea">South Korea</option>
              <option value="Australia">Australia</option>
              <option value="Brazil">Brazil</option>
              <option value="Mexico">Mexico</option>
              <option value="South Africa">South Africa</option>
              <option value="Nigeria">Nigeria</option>
              <option value="Kenya">Kenya</option>
            </select>
            <label
              class="absolute left-3  -top-2 pointer-events-none text-gray-400 text-sm bg-white px-1 transition-all duration-300
              peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2
              peer-focus:top-0 peer-focus:-translate-y-1/2 peer-focus:text-xs peer-focus:text-pro
              peer-not-placeholder-shown:top-0 peer-not-placeholder-shown:-translate-y-1/2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro" >
              Country
              <span class="text-red-500">*</span>
            </label>
            <p *ngIf="formErrors.country" class="text-red-500 text-xs mt-2 flex items-center gap-1">
              <i class="fa-solid fa-exclamation-circle"></i>
              {{ formErrors.country }}
            </p>
          </div>

          <!-- Postal Code -->
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="newLocation.postalCode"
              name="postalCode"
              placeholder=" "
              class="text-gray-700 peer w-full border rounded-lg p-3 border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro outline-none transition"
              [class.border-red-500]="formErrors.postalCode"
              required
              maxlength="20"
              pattern="[a-zA-Z0-9\s\-]*"
            />
            <label
              class="absolute left-3 pointer-events-none text-gray-400 text-sm bg-white px-1 transition-all duration-300
              peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2
              peer-focus:top-0 peer-focus:-translate-y-1/2 peer-focus:text-xs peer-focus:text-pro
              peer-not-placeholder-shown:top-0 peer-not-placeholder-shown:-translate-y-1/2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro">
              Postal Code
              <span class="text-red-500">*</span>
            </label>
            <p *ngIf="formErrors.postalCode" class="text-red-500 text-xs mt-2 flex items-center gap-1">
              <i class="fa-solid fa-exclamation-circle"></i>
              {{ formErrors.postalCode }}
            </p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-3 pt-6 border-t border-gray-200">
          <button
            type="button"
            (click)="closeModal()"
          class="cursor-pointer bg-gray-100 hover:bg-gray-200 text-gray-600 px-5 py-2 rounded-md transition font-medium disabled:opacity-50 duration-200"
          >
            Cancel
          </button>
          <button
            type="submit"
          class=" bg-[#0F7B8A] hover:bg-[#0c656c] transition-color duration-300 text-white cursor-pointer px-5 py-2 rounded-md transition font-medium shadow-sm disabled:opacity-50 flex items-center gap-2"
            [disabled]="isLoading"
          >
            <span *ngIf="isLoading" class="flex items-center gap-2">
              <i class="fa-solid fa-spinner animate-spin"></i>
              Processing...
            </span>
            <span *ngIf="!isLoading" class="flex items-center gap-2">
              {{ isEditing ? 'Update Location' : 'Create Location' }}
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div
    *ngIf="showDeleteConfirm"
    class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 backdrop-blur-sm"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-[90%] max-w-md text-center border border-gray-200">
      <h3 class="text-xl font-semibold text-gray-600 mb-3">
        Confirm Deletion
      </h3>
      <p class="text-gray-500 mb-6">
        Are you sure you want to delete this location?
      </p>
      <div class="flex justify-center gap-4">
        <button
          (click)="cancelDelete()"
          class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-2 rounded-lg font-medium transition duration-200 disabled:opacity-50 cursor-pointer"
          [disabled]="isLoading"
        >
          Cancel
        </button>
        <button
          (click)="deleteLocation()"
          class="bg-red-600 hover:bg-red-700 cursor-pointer text-white px-5 py-2 rounded-lg font-medium transition duration-200 disabled:opacity-50 flex items-center gap-2"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading" class="flex items-center gap-2">
            <i class="fa-solid fa-spinner animate-spin"></i>
            Deleting...
          </span>
          <span *ngIf="!isLoading">Delete</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Error Modal -->
  <div
    *ngIf="showDeleteErrorModal"
    class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 backdrop-blur-sm"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-[90%] max-w-md text-center border border-gray-200">
      <div class="bg-yellow-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
        <i class="fa-solid fa-exclamation-triangle text-yellow-600 text-xl"></i>
      </div>
      <h2 class="text-xl font-bold text-gray-900 mb-2">Cannot Delete Location</h2>
      <p class="text-gray-600 text-sm mb-3">{{ deleteError }}</p>
      <p class="text-xs text-gray-500 mb-6">
        Please remove all department associations before deleting this location.
      </p>

      <button
        (click)="closeErrorModal()"
        class="bg-pro text-white px-6 py-2.5 rounded-lg hover:bg-pro-hover transition-all duration-200 shadow-md hover:shadow-lg font-medium text-sm"
      >
        Understand
      </button>
    </div>
  </div>
</div>
