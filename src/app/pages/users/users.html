<div class="p-6 space-y-6">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <div>
      <h2 class="text-2xl font-semibold">User Management</h2>
      <p class="text-gray-500">Create and manage user accounts</p>
    </div>
    <button
      (click)="addUser()"
      class="bg-pro text-white px-4 py-2 rounded-lg hover:bg-pro-hover transition cursor-pointer"
    >
      + Add User
    </button>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table
      class="min-w-full text-[0.9rem] bg-white rounded-xl shadow border border-gray-200 overflow-hidden text-gray-700"
    >
      <thead class="bg-gray-50 text-left border-b border-gray-200">
        <tr>
          <th class="py-3 px-4">ID</th>
          <th class="py-3 px-4">Name</th>
          <th class="py-3 px-4">Email</th>
          <th class="py-3 px-4">Position</th>
          <th class="py-3 px-4">Level</th>
          <th class="py-3 px-4">Role</th>
          <th class="py-3 px-4">Department</th>
          <th class="py-3 px-4 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let user of users; trackBy: trackByUserId"
          class="border-b hover:bg-gray-50 transition rounded-xl border-gray-200"
        >
          <td class="py-3 px-4">{{ user?.employeeId }}</td>
          <td class="py-3 px-4">
            <i class="fa-regular fa-circle-user text-pro me-2"></i> {{ user?.fullName }}
          </td>
          <td class="py-3 px-4">{{ user?.email }}</td>
          <td class="py-3 px-4">{{ user?.position?.name || 'N/A' }}</td>
          <td class="py-3 px-4">{{ user?.level?.name || 'N/A' }}</td>
          <td class="py-3 px-4">
            <span [ngClass]="getRoleClass(user.role)">
              {{ user?.role }}
            </span>
          </td>
          <td class="py-3 px-4">{{ user?.department?.name || 'N/A' }}</td>
          <td class="py-3 px-4 flex justify-center gap-2">
            <button
              (click)="editUser(user)"
              class="text-gray-600 hover:text-pro transition px-3 py-1 rounded text-sm"
            >
              <i class="fa-regular fa-pen-to-square"></i>
            </button>
            <button
              (click)="confirmDelete(user._id)"
              class="text-red-500 hover:text-red-700 transition px-3 py-1 rounded text-sm"
            >
              <i class="fa-regular fa-trash-can"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Form Modal -->
  <div
    *ngIf="showForm"
    class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 backdrop-blur-sm"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl animate-fadeIn">
      <h3 class="text-2xl font-semibold mb-6 text-gray-800">
        {{ selectedUser ? 'Edit User' : 'Add User' }}
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- First Name -->
        <div class="relative">
          <input
            [(ngModel)]="formData.firstName"
            id="firstName"
            type="text"
            [ngClass]="{ 'border-red-500': submitted && !formData.firstName }"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder=" "
          />
          <label
            for="firstName"
            class="absolute left-3 top-3 text-gray-500 text-sm transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-sm peer-focus:text-pro bg-white px-1"
          >
            First Name *
          </label>
        </div>

        <!-- Last Name -->
        <div class="relative">
          <input
            [(ngModel)]="formData.lastName"
            id="lastName"
            type="text"
            [ngClass]="{ 'border-red-500': submitted && !formData.lastName }"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder="First Name"
          />
          <label
            for="LastName"
            class="absolute left-3 top-3 text-gray-500 text-sm transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-sm peer-focus:text-pro bg-white px-1"
          >
            last Name *
          </label>
        </div>

        <!-- Nickname -->
        <div class="relative">
          <input
            [(ngModel)]="formData.nickname"
            id="nickname"
            type="text"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder="Nickname"
          />
          <label
            for="nickname"
            class="absolute left-3 top-3 text-gray-500 text-sm transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-sm peer-focus:text-pro bg-white px-1"
          >
            Nickname
          </label>
        </div>

        <!-- Contact Number -->
        <div class="relative">
          <input
            [(ngModel)]="formData.contactNumber"
            id="contactNumber"
            type="tel"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder="Contact Number"
          />
          <label
            for="contactNumber"
            class="absolute left-3 top-3 text-gray-500 text-sm transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-sm peer-focus:text-pro bg-white px-1"
          >
            Contact Number
          </label>
        </div>

        <!-- Email -->
        <div class="relative">
          <input
            [(ngModel)]="formData.email"
            id="email"
            type="email"
            [ngClass]="{ 'border-red-500': submitted && !formData.email }"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder="Email"
          />
          <label
            for="email"
            class="absolute left-3 top-3 text-gray-500 text-sm transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-sm peer-focus:text-pro bg-white px-1"
          >
            Email *
          </label>
        </div>

        <!-- Position -->
        <div>
          <select
            [(ngModel)]="formData.positionId"
            [ngClass]="{ 'border-red-500': submitted && !formData.positionId }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition"
          >
            <option value="" disabled>Select Position *</option>
            <option *ngFor="let p of positions" [value]="p._id">{{ p.name }}</option>
          </select>
        </div>

        <!-- Level -->
        <div>
          <select
            [(ngModel)]="formData.levelId"
            [ngClass]="{ 'border-red-500': submitted && !formData.levelId }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition"
          >
            <option value="" disabled>Select Level *</option>
            <option *ngFor="let l of levels" [value]="l._id">{{ l.name }}</option>
          </select>
        </div>

        <!-- Role -->
        <div>
          <select
            [(ngModel)]="formData.role"
            [ngClass]="{ 'border-red-500': submitted && !formData.role }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition"
          >
            <option value="" disabled selected>Select Role</option>
            <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
          </select>
        </div>

        <!-- Department -->
        <div>
          <select
            [(ngModel)]="formData.departmentId"
            [ngClass]="{ 'border-red-500': submitted && !formData.departmentId }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition"
          >
            <option value="" disabled selected>Select Department *</option>
            <option *ngFor="let dept of departments" [value]="dept._id">
              {{ dept.name }}
            </option>
          </select>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-3 mt-8">
        <button
          (click)="showForm = false"
          class="bg-white hover:bg-gray-100 text-gray-800 px-5 py-2 rounded-md border border-gray-300 transition font-medium"
        >
          Cancel
        </button>
        <button
          (click)="saveUser()"
          class="bg-pro hover:bg-pro-hover text-white cursor-pointer px-5 py-2 rounded-md transition font-medium shadow-sm"
        >
          {{ selectedUser ? 'Update' : 'Create' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div
    *ngIf="showConfirm"
    class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-[90%] max-w-md text-center">
      <h3 class="text-xl font-semibold text-gray-800 mb-3">Confirm Deletion</h3>
      <p class="text-gray-500 mb-6">Are you sure you want to delete this user?</p>
      <div class="flex justify-center gap-4">
        <button
          (click)="deleteUserConfirmed()"
          class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-md font-medium transition"
        >
          Yes, Delete
        </button>
        <button
          (click)="cancelDelete()"
          class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-2 rounded-md font-medium transition"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
