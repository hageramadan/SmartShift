<div class="p-6 space-y-6">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <div>
      <h2 class="text-2xl font-semibold">User Management</h2>
      <p class="text-gray-500">Create and manage user accounts</p>
    </div>
    <button
      (click)="addUser()"
      class="bg-pro text-white px-4 py-2 rounded-lg hover:bg-pro-hover transition cursor-pointer"
    >
      + Add User
    </button>
  </div>

  <!-- Advanced Filter Section -->
  <div class="mb-6 bg-white rounded-xl shadow-sm border border-gray-100 p-4">
    <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between">
      <!-- Department Filter -->
      <div class="flex-1 w-full">
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-filter mr-2 text-teal-600"></i>
            Filter by Department
          </label>
          <div class="relative">
            <select
              [(ngModel)]="selectedDepartmentId"
              (change)="applyFilters()"
              class="w-full px-4 py-3 border border-gray-400 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none text-sm bg-white appearance-none cursor-pointer hover:border-teal-700/60 text-gray-600"
            >
              <option value="">All Departments</option>
              <option *ngFor="let department of departments" [value]="department._id">
                {{ department.name }}
              </option>
            </select>
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
              <i class="fas fa-chevron-down text-teal-600 text-sm"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Position Filter -->
      <div class="flex-1 w-full">
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-filter mr-2 text-teal-600"></i>
            Filter by Position
          </label>
          <div class="relative">
            <select
              [(ngModel)]="selectedPositionId"
              (change)="applyFilters()"
              class="w-full px-4 py-3 border border-gray-400 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none text-sm bg-white appearance-none cursor-pointer hover:border-teal-700/60 text-gray-600"
            >
              <option value="">All Positions</option>
              <option *ngFor="let position of positions" [value]="position._id">
                {{ position.name }}
              </option>
            </select>
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
              <i class="fas fa-chevron-down text-teal-600 text-sm"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Role Filter -->
      <div class="flex-1 w-full">
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-filter mr-2 text-teal-600"></i>
            Filter by Role
          </label>
          <div class="relative">
            <select
              [(ngModel)]="selectedRole"
              (change)="applyFilters()"
              class="w-full px-4 py-3 border border-gray-400 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none text-sm bg-white appearance-none cursor-pointer hover:border-teal-700/60 text-gray-600"
            >
              <option value="">All Roles</option>
              <option *ngFor="let role of roles" [value]="role">
                {{ role }}
              </option>
            </select>
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
              <i class="fas fa-chevron-down text-teal-600 text-sm"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Input -->
      <div class="flex-1 w-full">
        <label class="block text-sm font-medium text-gray-700 mb-2">
          <i class="fas fa-search mr-2 text-teal-600"></i>
          Search Users
        </label>
        <div class="relative">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            placeholder="Search user names..."
            class="w-full pl-11 pr-10 py-3 border border-gray-400 rounded-xl focus:ring-0 focus:ring-teal-600 focus:border-teal-600 outline-none text-sm bg-white hover:border-teal-800/60 text-gray-600"
          />
          <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
            <i class="fas fa-search text-gray-300"></i>
          </div>
          <div
            *ngIf="searchTerm"
            class="absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer"
            (click)="clearSearch()"
          >
            <i class="fas fa-times text-gray-400 hover:text-teal-500"></i>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-2 self-end">
        <button
          (click)="refreshData()"
          class="flex items-center gap-2 px-4 py-3 border border-none rounded-xl hover:border-teal-700 hover:bg-green-500/5 text-sm font-medium text-gray-600"
          title="Refresh Data"
        >
          <i class="fas fa-sync-alt text-xs"></i>
          Refresh
        </button>

        <button
          *ngIf="hasActiveFilters()"
          (click)="clearAllFilters()"
          class="flex items-center gap-2 px-4 py-3 border border-teal-800 rounded-xl border-none hover:bg-red-50 text-sm font-medium text-red-400 hover:text-red-800"
          title="Clear All Filters"
        >
          <i class="fas fa-times text-xs"></i>
          Clear Filters
        </button>
      </div>
    </div>

    <!-- Active Filters Display -->
    <div *ngIf="hasActiveFilters()" class="mt-4 flex flex-wrap gap-2">
      <div
        *ngIf="searchTerm"
        class="flex items-center gap-2 bg-blue-50 text-teal-900 px-3 py-2 rounded-lg text-sm border border-gray-300"
      >
        <i class="fas fa-search text-xs"></i>
        <span>Search: "{{ searchTerm }}"</span>
        <button (click)="clearSearch()" class="hover:text-gray-900 ml-1">
          <i class="fas fa-times text-xs"></i>
        </button>
      </div>

      <div
        *ngIf="selectedDepartmentId"
        class="flex items-center gap-2 bg-green-50 text-teal-700 px-3 py-2 rounded-lg text-sm border border-green-200"
      >
        <i class="fas fa-building text-xs"></i>
        <span>Department: {{ getDepartmentName(selectedDepartmentId) }}</span>
        <button (click)="clearDepartmentFilter()" class="hover:text-gray-700 ml-1">
          <i class="fas fa-times text-xs"></i>
        </button>
      </div>

      <div
        *ngIf="selectedPositionId"
        class="flex items-center gap-2 bg-purple-50 text-gray-700 px-3 py-2 rounded-lg text-sm border border-gray-300"
      >
        <i class="fas fa-briefcase text-xs"></i>
        <span>Position: {{ getPositionName(selectedPositionId) }}</span>
        <button (click)="clearPositionFilter()" class="hover:text-gray-700 ml-1">
          <i class="fas fa-times text-xs"></i>
        </button>
      </div>

      <div
        *ngIf="selectedRole"
        class="flex items-center gap-2 bg-green-50 text-teal-700 px-3 py-2 rounded-lg text-sm border border-green-200"
      >
        <i class="fas fa-user-tag text-xs"></i>
        <span>Role: {{ selectedRole }}</span>
        <button (click)="clearRoleFilter()" class="hover:text-gray-700 ml-1">
          <i class="fas fa-times text-xs"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="mb-4 flex items-center justify-between">
    <p class="text-sm text-gray-600">
      Showing <span class="font-semibold text-teal-600">{{ filteredUsers.length }}</span> of
      <span class="font-semibold text-teal-600">{{ users.length }}</span> users
      <span *ngIf="hasActiveFilters()" class="text-teal-600 font-medium ml-2">
        â€¢ Filtered Results
      </span>
    </p>

    <div *ngIf="filteredUsers.length === 0 && hasActiveFilters()" class="text-sm">
      <button (click)="clearAllFilters()" class="text-teal-600 hover:text-teal-700 font-medium">
        <i class="fas fa-redo mr-1"></i>
        Clear filters to see all users
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table
      class="min-w-full text-[0.9rem] bg-white rounded-xl shadow border border-gray-200 overflow-hidden text-gray-700"
    >
      <thead class="bg-gray-50 text-left border-b border-gray-200">
        <tr>
          <th class="py-3 px-4">ID</th>
          <th class="py-3 px-4">Name</th>
          <th class="py-3 px-4">Email</th>
          <th class="py-3 px-4">Position</th>
          <th class="py-3 px-4">Level</th>
          <th class="py-3 px-4">Role</th>
          <th class="py-3 px-4">Department</th>
          <th class="py-3 px-4 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let user of filteredUsers; trackBy: trackByUserId"
          class="border-b hover:bg-gray-50 transition rounded-xl border-gray-200"
        >
          <td class="py-3 px-4">{{ user?.employeeId }}</td>
          <td class="py-3 px-4">
            <i class="fa-regular fa-circle-user text-pro me-2"></i> {{ user?.fullName }}
          </td>
          <td class="py-3 px-4">{{ user?.email }}</td>
          <td class="py-3 px-4">{{ user?.position?.name || 'N/A' }}</td>
          <td class="py-3 px-4">{{ user?.level?.name || 'N/A' }}</td>
          <td class="py-3 px-4">
            <span [ngClass]="getRoleClass(user.role)">
              {{ user?.role }}
            </span>
          </td>
          <td class="py-3 px-4">{{ user?.department?.name || 'N/A' }}</td>
          <td class="py-3 px-4 flex justify-center gap-2">
            <button
              (click)="editUser(user)"
              class="text-gray-600 hover:text-pro transition px-3 py-1 rounded text-sm"
            >
              <i class="fa-regular fa-pen-to-square"></i>
            </button>
            <button
              (click)="confirmDelete(user._id)"
              class="text-red-500 hover:text-red-700 transition px-3 py-1 rounded text-sm"
            >
              <i class="fa-regular fa-trash-can"></i>
            </button>
          </td>
        </tr>

        <!-- Empty State -->
        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="8" class="py-12 px-4 text-center">
            <div class="flex flex-col items-center gap-3 text-gray-400">
              <i class="fas fa-users text-4xl"></i>
              <p class="text-sm font-medium">
                {{ hasActiveFilters() ? 'No users match your filters' : 'No users found' }}
              </p>
              <p class="text-xs">
                {{
                  hasActiveFilters()
                    ? 'Try adjusting your search or filters'
                    : 'Create your first user to get started'
                }}
              </p>
              <button
                *ngIf="hasActiveFilters()"
                (click)="clearAllFilters()"
                class="mt-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-sm font-medium"
              >
                Clear Filters
              </button>
              <button
                *ngIf="!hasActiveFilters()"
                (click)="addUser()"
                class="mt-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-sm font-medium"
              >
                <i class="fas fa-plus mr-1.5"></i>
                Add First User
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="filteredUsers.length > 0" class="flex justify-between items-center mt-4">
    <div class="text-sm text-gray-600">Page {{ currentPage }} of {{ totalPages }}</div>
    <div class="flex gap-2">
      <button
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm"
      >
        Previous
      </button>
      <button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed text-sm"
      >
        Next
      </button>
    </div>
  </div>

  <!-- Form Modal -->
  <div
    *ngIf="showForm"
    class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 backdrop-blur-sm"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl">
      <h3 class="text-2xl font-semibold mb-6 text-gray-800">
        {{ selectedUser ? 'Edit User' : 'Add User' }}
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- First Name -->
        <div class="relative">
          <input
            [(ngModel)]="formData.firstName"
            id="firstName"
            type="text"
            [ngClass]="{ 'border-red-500': submitted && !formData.firstName }"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder=" "
          />
          <label
            for="firstName"
            class="absolute left-3 top-3 text-gray-500 text-sm bg-white px-1 transition-all duration-300 peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-xs peer-focus:text-pro peer-focus:font-medium peer-not-placeholder-shown:-top-2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro peer-not-placeholder-shown:font-medium"
          >
            First Name<span class="text-red-500">*</span>
          </label>
        </div>

        <!-- Last Name -->
        <div class="relative">
          <input
            [(ngModel)]="formData.lastName"
            id="lastName"
            type="text"
            [ngClass]="{ 'border-red-500': submitted && !formData.lastName }"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder=" "
          />
          <label
            for="LastName"
            class="absolute left-3 top-3 text-gray-500 text-sm bg-white px-1 transition-all duration-300 peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-xs peer-focus:text-pro peer-focus:font-medium peer-not-placeholder-shown:-top-2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro peer-not-placeholder-shown:font-medium"
          >
            last Name <span class="text-red-500">*</span>
          </label>
        </div>

        <!-- Nickname -->
        <div class="relative">
          <input
            [(ngModel)]="formData.nickname"
            id="nickname"
            type="text"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder=" "
          />
          <label
            for="nickname"
            class="absolute left-3 top-3 text-gray-500 text-sm bg-white px-1 transition-all duration-300 peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-xs peer-focus:text-pro peer-focus:font-medium peer-not-placeholder-shown:-top-2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro peer-not-placeholder-shown:font-medium"
          >
            Nickname
          </label>
        </div>

        <!-- Contact Number -->
        <div class="relative">
          <input
            [(ngModel)]="formData.contactNumber"
            id="contactNumber"
            type="tel"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder="Contact Number"
          />
          <label
            for="contactNumber"
            class="absolute left-3 top-3 text-gray-500 text-sm bg-white px-1 transition-all duration-300 peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-xs peer-focus:text-pro peer-focus:font-medium peer-not-placeholder-shown:-top-2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro peer-not-placeholder-shown:font-medium"
          >
            Contact Number
          </label>
        </div>

        <!-- Email -->
        <div class="relative">
          <input
            [(ngModel)]="formData.email"
            id="email"
            type="email"
            [ngClass]="{ 'border-red-500': submitted && !formData.email }"
            class="peer border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition placeholder-transparent"
            placeholder=""
          />
          <label
            for="email"
            class="absolute left-3 top-3 text-gray-500 text-sm bg-white px-1 transition-all duration-300 peer-placeholder-shown:top-3 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:-top-2 peer-focus:text-xs peer-focus:text-pro peer-focus:font-medium peer-not-placeholder-shown:-top-2 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-pro peer-not-placeholder-shown:font-medium"
          >
            Email<span class="text-red-500">*</span>
          </label>
        </div>

        <!-- Position -->
        <div>
          <select
            [(ngModel)]="formData.positionId"
            [ngClass]="{ 'border-red-500': submitted && !formData.positionId }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition text-gray-700"
          >
            <option value="" disabled>Select Position <span class="text-red-500">*</span></option>
            <option *ngFor="let p of positions" [value]="p._id">{{ p.name }}</option>
          </select>
        </div>

        <!-- Level -->
        <div>
          <select
            [(ngModel)]="formData.levelId"
            [ngClass]="{ 'border-red-500': submitted && !formData.levelId }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition text-gray-700"
          >
            <option value="" disabled>Select Level <span class="text-red-500">*</span></option>
            <option *ngFor="let l of levels" [value]="l._id">{{ l.name }}</option>
          </select>
        </div>

        <!-- Role -->
        <div>
          <select
            [(ngModel)]="formData.role"
            [ngClass]="{ 'border-red-500': submitted && !formData.role }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition text-gray-700"
          >
            <option value="" disabled selected>Select Role<span class="text-red-500">*</span></option>
            <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
          </select>
        </div>

        <!-- Department -->
        <div>
          <select
            [(ngModel)]="formData.departmentId"
            [ngClass]="{ 'border-red-500': submitted && !formData.departmentId }"
            class="border border-gray-300 focus:border-pro focus:ring-1 focus:ring-pro p-3 w-full rounded-md outline-none transition text-gray-700"
          >
            <option value="" disabled selected>Select Department <span class="text-red-500">*</span></option>
            <option *ngFor="let dept of departments" [value]="dept._id">
              {{ dept.name }}
            </option>
          </select>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-3 mt-8">
        <button
          (click)="showForm = false"
          class="bg-white hover:bg-gray-100 text-gray-800 px-5 py-2 rounded-md border border-gray-300 transition font-medium"
        >
          Cancel
        </button>
        <button
          (click)="saveUser()"
          class="bg-pro hover:bg-pro-hover text-white cursor-pointer px-5 py-2 rounded-md transition font-medium shadow-sm"
        >
          {{ selectedUser ? 'Update' : 'Create' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div
    *ngIf="showConfirm"
    class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-[90%] max-w-md text-center">
      <h3 class="text-xl font-semibold text-gray-800 mb-3">Confirm Deletion</h3>
      <p class="text-gray-500 mb-6">Are you sure you want to delete this user?</p>
      <div class="flex justify-center gap-4">
        <button
          (click)="deleteUserConfirmed()"
          class="bg-red-400 hover:bg-red-700 text-white px-5 py-2 rounded-md font-medium transition"
        >
          Yes, Delete
        </button>
        <button
          (click)="cancelDelete()"
          class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-2 rounded-md font-medium transition"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
